local openrtm  = require "openrtm"


--[[
 @file {{ idlFileParam.getIdlFileNoExt() }}_idl_examplefile.py
 @brief Lua example implementations generated from {{ idlFileParam.getIdlFile() }}
 @date $Date$
{% if rtcParam.doc_creator.length > 0 %}
 @author {{rtcParam.doc_creator}}
{% endif %}
{%- if rtcParam.doc_license.length > 0 %}
 {{ rtcParam.doc_license }}{% endif %}

--]]


local {{ idlFileParam.getIdlFileNoExt() }}_idl_example = {}


{% for serviceClassParam in idlFileParam.serviceClass %}

{{ idlFileParam.getIdlFileNoExt() }}_idl_example.{{ getInterfaceBasename(serviceClassParam.name) }}_i = {}
{{ idlFileParam.getIdlFileNoExt() }}_idl_example.{{ getInterfaceBasename(serviceClassParam.name) }}_i.new = function()
    --[[
    @class {{ getInterfaceBasename(serviceClassParam.name) }}_i
    Example class implementing IDL interface {{ convFormat(serviceClassParam.name) }}
    --]]
    local obj = {}

    --[[
    @brief standard constructor
    Initialise member variables here
    --]]

{%- for serviceMethodParam in serviceClassParam.methods %}
    -- {{ convCORBA2LuaArg(serviceMethodParam.type) }} {{ serviceMethodParam.name }}({% for serviceArgumentParam in serviceMethodParam.params %}{% if loop.index > 1 %}, {% endif %}{{ serviceArgumentParam.direction }} {{ convCORBA2LuaArg(serviceArgumentParam.type) }} {{ serviceArgumentParam.name }}{% endfor %})
    function obj:{{ serviceMethodParam.name }}({{ selectInParamName(serviceMethodParam) }})
        error(openrtm.Manager:getORB():newexcept{"CORBA::NO_IMPLEMENT",
              minor=0,
              completed=openrtm.Manager:getORB().types:lookup("::CORBA::CompletionStatus").labelvalue.COMPLETED_NO})
        -- *** Implement me
        -- Must return:{{ selectOutParamName(serviceMethodParam) }}
    end
{% endfor %}
    return obj
end

{%- endfor %}
if openrtm.Manager.is_main() then

    local oil = require "oil"
    oil.main(function()
        -- Initialise the ORB
        local orb = oil.init{ flavor = "cooperative;corba;intercepted;typed;base;" }

        oil.newthread(self._orb.run, self._orb)

        -- Create an instance of a servant class
        local obj = {{ idlFileParam.getIdlFileNoExt() }}_idl_example.{{ getInterfaceBasename(idlFileParam.serviceClass[0].name) }}_i.new()
        local servant = orb:newservant(obj, nil, "{{ convertServiceInterfaceName(idlFileParam.serviceClass[0].name) }}")



        -- Get the object reference to the object
        local objref = openrtm.RTCUtil.getReference()

        -- Print a stringified IOR for it
        print(orb:tostring(servant))

        -- Run the ORB, blocking this thread
        orb:run()
    end)
end

return {{ idlFileParam.getIdlFileNoExt() }}_idl_example
