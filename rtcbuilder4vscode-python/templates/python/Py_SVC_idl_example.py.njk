#!/usr/bin/env python
# -*- coding: utf-8 -*-
# -*- Python -*-

"""
 @file {{ getIdlFileNoExt(idlFileParam.idlPath) }}_idl_example.py
 @brief Python example implementations generated from {{ getFileName(idlFileParam.idlPath) }}
 @date $Date$

{%- if rtcParam.doc_creator.length > 0 %}
 @author {{ rtcParam.doc_creator }}
{%- endif %}
{%- if rtcParam.doc_license.length > 0 %}

 {{ rtcParam.doc_license }}
{%- endif %}

"""

import omniORB
from omniORB import CORBA, PortableServer
{{ convModuleName(idlFileParam) }}

{% for serviceClassParam in idlFileParam.serviceClass %}

class {{ getInterfaceBasename(serviceClassParam.name) }}_i ({{ getModuleName(serviceClassParam.name) }}__POA.{{ getInterfaceBasename(serviceClassParam.name) }}):
    """
    @class {{ getInterfaceBasename(serviceClassParam.name) }}_i
    Example class implementing IDL interface {{ convFormat(serviceClassParam.name) }}
    """

    def __init__(self):
        """
        @brief standard constructor
        Initialise member variables here
        """
        pass

{%- for serviceMethodParam in serviceClassParam.methods %}
    # {{ convCORBA2PythonArg(serviceMethodParam.type) }} {{ serviceMethodParam.name }}({%for serviceArgumentParam in serviceMethodParam.params %}{% if loop.index > 1 %}, {% endif %}{{ serviceArgumentParam.direction }} {{ convCORBA2PythonArg(serviceArgumentParam.type) }} {{ serviceArgumentParam.name }}{% endfor %})
    def {{ serviceMethodParam.name }}(self{{ selectInParamName(serviceMethodParam) }}):
        raise CORBA.NO_IMPLEMENT(0, CORBA.COMPLETED_NO)
        # *** Implement me
        # Must return:{{ selectOutParamName(serviceMethodParam) }}
{% endfor %}

{%- endfor %}
if __name__ == "__main__":
    import sys
    
    # Initialise the ORB
    orb = CORBA.ORB_init(sys.argv)
    
    # As an example, we activate an object in the Root POA
    poa = orb.resolve_initial_references("RootPOA")

    # Create an instance of a servant class
    servant = {{ getInterfaceBasename(idlFileParam.serviceClass[0].name) }}_i()

    # Activate it in the Root POA
    poa.activate_object(servant)

    # Get the object reference to the object
    objref = servant._this()
    
    # Print a stringified IOR for it
    print(orb.object_to_string(objref))

    # Activate the Root POA's manager
    poa._get_the_POAManager().activate()

    # Run the ORB, blocking this thread
    orb.run()

